{% extends 'base_nav.html' %}
{% block title %}
  게시글 신고 관리
{% endblock title %}
{% block content %}
  
  <h1>게시글 신고 관리</h1>
  <div>
  {% for report in reports %}
    <div id="report-form-{{report.post}}">
      게시글 번호: {{report.post}},
      신고 수: {{report.pk__count}}
      <form class="delete-post-form" data-post-pk="{{report.post}}" data-planet-name="{{planet.name}}">
        {% csrf_token %}
        <input type="submit" value="게시글 삭제">
      </form>
    </div>
  {% endfor %}
  </div>
  <script>
    const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value
    const deleteForms = document.querySelectorAll('.delete-post-form')

    deleteForms.forEach((btn) => {
      btn.addEventListener('submit', (e) => {

        e.preventDefault()
        const postPk = e.target.dataset.postPk
        const planetName = e.target.dataset.planetName

        if(confirm('삭제처리 하시겠습니까 ?')) {
          axios({
            method:'post',
            url:`/planets/${planetName}/${postPk}/delete/`,
            headers:{'X-CSRFToken': csrftoken,}
          })
          .then((response) => {
            if(response.data.success === true) {
              alert('삭제 완료되었습니다.')
              const reportDiv = document.getElementById(`report-form-${postPk}`)
              reportDiv.remove()
            }
          })
          .catch((error) => {
            console.log(error.response)
          })
        }
      })
    })
  </script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
{% endblock content %}